```{r}
library(tidyverse)
```

```{r}
small <- da37692.0002[775]
small <- small %>% filter(V0772 == "CA")
```

```{r}
tiny <- da04572.0002[1056]
tiny <- tiny %>% filter(V1056 == "(06) California")
```


```{r}
122374/(122374+139446+897316)
(1227+119)/(20064)
1375/(20064)
```
```{r}
(1374+347)/14499
1757/14499

```
  
```{r}
work2004 <- da04572.0002 %>% select("V1057", "V0014","V0018","V0029","V0030","V0031","V0032","V0033", "V0034", "V0059", "V0058", "V1740", "V1857","V2272", "V2273")
work2016 <- da37692.0002 %>% select("V0772", "RV0002","RV0003", "RV0008", "RV0051", "RV0054", "V1145", "V1201", "V1202")
```

```{r}
#Creating Race Categorical for 2004 based on classification in 2016
work2004 <- work2004 %>% mutate(Race = as.factor(case_when(
  (work2004$V0029 == "(1) White") + (work2004$V0030 == "(2) Black or African American") + (work2004$V0031 == "(3) American Indian or Alaska Native") + (work2004$V0032 == "(4) Asian") > 0 & work2004$V0018 == "(2) No" ~ "(6) 6 = 2+ Races (NH)",
  work2004$V0029 == "(1) White" & work2004$V0018 == "(2) No" ~ "(1) 1 = White (NH)",
  work2004$V0030 == "(2) Black or African American" & work2004$V0018 == "(2) No" ~ "(2) 2 = Black (NH)",
  work2004$V0018 == "(1) Yes" ~ "(3) 3 = Hispanic",
  work2004$V0031 == "(3) American Indian or Alaska Native" & work2004$V0018 == "(2) No" ~ "(4) 4 = American Indian/Alaska Native (NH)",
  work2004$V0032 == "(4) Asian" | work2004$V0033 == "(5) Native Hawaiian or other Pacific Islander" & work2004$V0018 == "(2) No" ~ "(5) 5 = Asian/Native Hawaiian/Other Pacific Islander (NH)",
  work2004$V0034 == "(6) All other races" & work2004$V0018 == "(2) No" ~ "(8) 8 = Other (NH)",
  TRUE ~ "(9) 9 = Uncategorized - Missing"
)))
```

```{r}
#Creating Age Categorical for 2004 based on classification in 2016
work2004 <- work2004 %>% mutate(AgeCat = as.factor(case_when(
  between(work2004$V0014, 18, 24) ~ "(01) 1 = 18-24",
  between(work2004$V0014, 25, 34) ~ "(02) 2 = 25-34",
  between(work2004$V0014, 35, 44) ~ "(03) 3 = 35-44",
  between(work2004$V0014, 45, 54) ~ "(04) 4 = 45-54",
  between(work2004$V0014, 55, 64) ~ "(05) 5 = 55-64",
  work2004$V0014 > 64 ~ "(06) 6 = 65 or Older",
  TRUE ~ "(99) 99 = Blank"
)))
```

```{r}
#Creating Veteran for 2004 based on classification in 2016
work2004 <-work2004 %>% mutate(Veteran = as.factor(case_when(
  work2004$V0059 == "(2) No" ~ "(02) 2 = Non-veteran",
  work2004$V0059 == "(1) Yes" ~"(01) 1 = Veteran",
  TRUE ~ "(98) 98 = DK/REF"
)))
```

```{r}
#Creating Marital Status for 2004 based on classification in 2016
work2004 <-work2004 %>% mutate(Marriage = as.factor(case_when(
  work2004$V0058 == "(5) Never Married" ~ "(05) 5 = Never married",
  work2004$V0058 == "(1) Married" ~"(01) 1 = Married",
  work2004$V0058 == "(4) Separated (Not because of incarceration)" ~"(03) 3 = Separated",
  work2004$V0058 == "(3) Divorced" ~"(04) 4 = Divorced",
  work2004$V0058 == "(2) Widowed" ~"(02) 2 = Widowed",
  TRUE ~ "(98) 98 = DK/REF"
)))
```

```{r}
#creating a numerical school year to make creating categories easier
work2004 <- work2004 %>% mutate(numericSchool = as.numeric(gsub("[[:space:]]", "",gsub("[\\(\\)]", "", regmatches(work2004$V1740, gregexpr("\\([[:digit:]]*?\\)", work2004$V1740))))))
#Creating Marital Status for 2004 based on classification in 2016. For the sake of this variable I am assuming that the highest grade of school attended is the highest grade of school completed. We just can't know
work2004 <-work2004 %>% mutate(Schooling = as.factor(case_when(
  (work2004$numericSchool < 12) ~ "(1) 1 = Less Than High School",
  work2004$numericSchool == 12 ~ "(2) 2 = High School Graduate",
  between(work2004$numericSchool,13,14) ~ "(3) 3 = Some College",
  between(work2004$numericSchool, 16,18) ~ "(4) 4 = College Degree or More",
  TRUE ~ "(9) 9 = Missing"
)))
```
```{r}
#create the medbefore variable
work2004 <-work2004 %>% mutate(MedBefore = as.factor(case_when(
  work2004$V2272 == "(1) Yes" ~ "(1) 1 = Yes",
  work2004$V2272 == "(2) No" ~ "(2) 2 = No ",
  work2004$V2272 == "(8) Refused" ~ "(-1) -1 = Don't Know",
  work2004$V2272 == "(7) Don't know" ~ "(-2) -2 = Refusal",
  TRUE ~ "(9) 9 = Missing"
)))
```

```{r}
#create the medAfter variable
work2004 <-work2004 %>% mutate(MedAfter = as.factor(case_when(
  work2004$V2273 == "(1) Yes" ~ "(1) 1 = Yes",
  work2004$V2273 == "(2) No" ~ "(2) 2 = No ",
  work2004$V2273 == "(8) Refused" ~ "(-1) -1 = Don't Know",
  work2004$V2273 == "(7) Don't know" ~ "(-2) -2 = Refusal",
  TRUE ~ "(9) 9 = Missing"
)))
```

